
<!DOCTYPE html>
<html lang="ko">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dongle&display=swap" rel="stylesheet">
<meta charset="UTF-8">
<title>ProxySG Sysinfo ë¶„ì„</title>
<style>
  body { font-family: "Segoe UI", Arial, sans-serif; background: #f5f7fa; margin: 20px; color:#333; }
  .dongle-regular {
    font-family: "Dongle", sans-serif;
    font-weight: 400;
    font-style: normal;
  }
   /* ğŸ”¹ ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */
  .top-nav {
    display: flex;
    justify-content: flex-end;
    gap: 4px;
    margin-bottom: -10px;
  }

  .nav-btn {
    background: #1e3a5f; color: white; border: none; border-radius: 8px;
    padding: 4px 8px; height: 12px; line-height: 10px;
    cursor: pointer; font-weight: 400; font-size: 0.75rem;
    text-decoration: none; transition: background 0.2s;
  }
  .nav-btn-soon {
    background: #98A1BC; color: #555879; border: none; border-radius: 8px;
    padding: 4px 8px; height: 12px; line-height: 10px;
    cursor: pointer; font-weight: 400; font-size: 0.75rem;
    text-decoration: none; transition: background 0.2s;
  }

  .nav-btn:hover {
    background: linear-gradient(135deg, #FF0066, #0046FF);
  }
	
  h1 {
  	font-size: 1.5em;
    background: #1e3a5f;
    color: white;
    padding: 12px 18px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;  /* ì¢Œìš° ë°°ì¹˜ */
    align-items: flex-end;            /* ì•„ë˜ ì •ë ¬ */
    margin-bottom: 5pt;
  }
  .header-wrap {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: #f3f4f6;  /* í•„ìš”ì‹œ ë°°ê²½ ì§€ì • */
    transition: all 0.25s ease;
  }

  .title-left {
    font-size: 1.6em;                   /* ì œëª© í¬ê²Œ */
    line-height: 0.7;                   /* ì¤„ ê°„ê²© ì¤„ì´ê¸° */
    margin-bottom: 0;                   /* ì•„ë˜ ì—¬ë°± ì œê±° */
  }

  .subtitle {
    font-size: 0.7em;
    font-weight: normal;
    color: #bcd0f7;
    opacity: 0.9;
    margin-top: 2px;                    /* ì œëª©ê³¼ì˜ ì—¬ë°± ìµœì†Œí™” */
    display: block;                     /* ì¤„ë°”ê¿ˆ í™•ì‹¤íˆ ì ìš© */
  }
  
  .date-container {
    text-align: right;
    line-height: 1.2;
  }

  .version {
    font-size: 24px;
    color: #bcd0f7; /* íšŒìƒ‰-íŒŒë‘ í†¤ìœ¼ë¡œ ì‚´ì§ ê°•ì¡° */
    opacity: 0.9;     /* ì‚´ì§ ì—°í•˜ê²Œ */
  }
  .date-header {
    font-size: 20px;
    color: #fff;
    margin: 0;
  }
  .section { background: white; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  .section-header { background: #1e3a5f; color: white; padding: 6px 12px; border-radius: 8px 8px 0 0; font-weight: bold; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: center; font-size: 13px; }
  th { background: #f0f2f5; font-weight: bold; }
  .nok { background-color: #f9d6d6; }  /* ë¹¨ê°„ìƒ‰ ë°°ê²½ */
  .yellow { background-color: #fff3cd; }  /* ë…¸ë€ìƒ‰ */
  .red { background-color: #f8d7da; }     /* ë¹¨ê°„ìƒ‰ */
  .white { background-color: #f0f2f5; }     /* ê¸°ë³¸ í°ìƒ‰ */
  input[type=file] { margin: 15px 0; }
  button { background:#1e3a5f; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; margin-top:10px; }
  button:hover { background:#294b7a; }
  
  .button-bar {
  display: flex;
  justify-content: space-between;  /* ì¢Œìš° ëìœ¼ë¡œ ë°°ì¹˜ */
  align-items: center;
  margin: -10px 0;
  }

  #fileInput {
    flex: 1;
    max-width: 180px; /* í•„ìš” ì‹œ ì¡°ì • */
  }

  #downloadBtn {
    background: #1e3a5f;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-left: 10px;
  }
  
  #downloadBtn:hover {
    background: #294b7a;
  }
  
  .notice {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 150px auto;
  }

  .notice-box {
    display: flex;
    align-items: center;
    background: linear-gradient(135deg, #e9eef8 0%, #f5f7fb 100%);
    border: 1.5px solid #b0c4de;
    border-radius: 20px;
    padding: 15px 20px;
    max-width: 680px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }

  .notice-icon {
    font-size: 30px;
    margin-right: 12px;
    color: #1e3a5f;
  }

  .notice-text {
    font-size: 14px;
    color: #2b2b2b;
    line-height: 1.6;
  }

  .notice-text strong {
    color: #1e3a5f;
  }
  
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f3f4f6;
    margin: 0;
    padding: 6px 40px 10px 40px;
  }

  /* === ëª¨ë‹¬ íŠ¸ë¦¬ê±° ë²„íŠ¼ === */
  #openModal {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #2563eb;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 1001;
  }
  
  #openModal:hover { background: #1e40af; }

  /* === ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ === */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(2px);
    z-index: 999;
    justify-content: center;
    align-items: center;
  }

  /* === ëª¨ë‹¬ ë³¸ì²´ === */
  .modal {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 940px;
    max-height: 90%;
    overflow-y: auto;
    position: relative;
    animation: fadeIn .3s ease;
  }

  .close-btn {
    position: absolute;
    top: 8px;
    right: 14px;
    background: transparent;
    color: #444;
    font-size: 28px;
    border: none;
    cursor: pointer;
    z-index: 1000;
  }
  .close-btn:hover { color: #000; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* === ê¸°ì¡´ Sysinfo curl UI ìŠ¤íƒ€ì¼ (ê°„ì†Œí™” ë²„ì „) === */
  .container {
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    margin: 30px;
    padding: 28px 32px;
  }
  
  h2 {
    margin: 0 0 18px 0;
    font-size: 20px;
    color: #1e3a8a;
    border-bottom: 2px solid #e0e7ff;
    padding-bottom: 6px;
  }
  
  label { font-weight: 600; font-size: 13px; color: #374151; display: block; }
  input[type="text"], input[type="password"], textarea {
    padding: 9px 10px;
    border: 1px solid #d1d5db;
    border-radius: 10px;
    font-size: 14px;
    background-color: #fafafa;
  }
  
  input:focus, textarea:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    background-color: #fff;
  }
  
  .input-row {
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    margin-bottom: 16px;
  }
  
  .w-sm { width: 100px; }
  .w-md { width: 140px; }
  textarea { width: 90%; min-height: 80px; resize: vertical; }
  pre {
    background: #0f172a;
    color: #e2e8f0;
    padding: 12px;
    border-radius: 10px;
    min-height: 120px;
    white-space: pre-wrap;
    overflow-x: auto;
    margin-top: 10px;
  }
  
  button {
    background: #2563eb;
    border: none;
    color: #fff;
    padding: 9px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
  }
  
  button:hover { background: #1e40af; }
  .actions { margin-top: 12px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
  .note { font-size: 13px; color: #1e3a8a; background: #eff6ff; border: 1px solid #bfdbfe; padding: 6px 10px; border-radius: 6px; }
  .badge { background: #e0e7ff; color: #1e3a8a; font-size: 12px; padding: 2px 6px; border-radius: 4px; margin-left: 6px; }
  
  /* ğŸ§² ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ ìŠ¤íƒ€ì¼ */
  #dropZone {
    margin-top: 18px;
    padding: 10px;
    border: 2px dashed #1e3a5f;
    border-radius: 10px;
    color: #1e3a5f;
    text-align: center;
    background: #f8fafc;
    font-weight: 400;
    transition: all 0.2s ease;
  }
  #dropZone.dragover {
    background: #e0e7ff;
    border-color: #2563eb;
    color: #1e40af;
  }
  
  
</style>
</head>
<body>

<div class="header-wrap">
	<div class="top-nav">
    <a href="https://etech-symantec.github.io/eos" class="nav-btn">â³ EoS í™•ì¸</a>
	<a href="https://etech-symantec.github.io/sysinfo" class="nav-btn">ğŸ§© Sysinfo ë¶„ì„</a>
    <a href="https://etech-symantec.github.io/isg" class="nav-btn">ğŸ” ISG ë¶„ì„</a>
    <a href="https://etech-symantec.github.io/trace" class="nav-btn">ğŸ“„ Trace ë¶„ì„</a>
    <a href="https://etech-symantec.github.io/sizing-sg" class="nav-btn">ğŸ“Š Sizing-SG ë³´ê¸°</a>
    <a href="https://etech-symantec.github.io/elk" class="nav-btn">ğŸ§¬ ELK ë¡œê·¸ ì„¤ì •</a>
    <a href="https://etech-symantec.github.io/" class="nav-btn-soon">ğŸš¦ PAC</a>
	</div>
		
	<h1 class="dongle-regular">
	  <div class="title-left">
	    ProxySG Auto Sysinfo Report<br>
	    <span class="subtitle">by ì´í…Œí¬ì‹œìŠ¤í…œ</span>
	  </div>
	  <div class="date-container">
	    <div class="version">ver.2025.10.31.01</div>
	    <div class="date-header" id="today-date"></div>
	  </div>
	</h1>
</div>

<!-- ğŸ“‚ íŒŒì¼ ì—…ë¡œë“œ ë°” -->
<div class="button-bar">
  <input type="file" id="fileInput" accept=".txt" multiple>
  <!-- ğŸ§² ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ -->
  <div id="dropZone">â¬†ï¸ sysinfo íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•´ì„œ ë†“ìœ¼ì„¸ìš”.</div>
  <button id="downloadBtn">ğŸ’¾ í˜„ì¬ í˜ì´ì§€ HTMLë¡œ ë‹¤ìš´ë¡œë“œ</button>
</div>



<!-- âœ… ì•ˆë‚´ ë¬¸êµ¬ (ìŠ¤íƒ€ì¼ ê°œì„  ë²„ì „) -->
<div id="notice" class="notice">
  <div class="notice-box">
    <span class="notice-icon">ğŸ”’</span>
    <div class="notice-text">
      ì´ í˜ì´ì§€ëŠ” <b>ë¡œì»¬ í™˜ê²½</b>ì—ì„œë§Œ ì‘ë™í•˜ë©°, íŒŒì¼ì´ ì™¸ë¶€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</b><br>
      ëª¨ë“  ì²˜ë¦¬ëŠ” <b>HTML ë‚´ë¶€ ìŠ¤í¬ë¦½íŠ¸</b>ì—ì„œë§Œ ìˆ˜í–‰ë©ë‹ˆë‹¤.
    </div>
  </div>
</div>

<div id="report"></div>


<script>
    // ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸° (yyyy. mm. dd. í˜•ì‹)
    function formatDate(date) {
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0'); // ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1
      const day = date.getDate().toString().padStart(2, '0'); // ë‚ ì§œ ë‘ ìë¦¿ìˆ˜ë¡œ ë§ì¶”ê¸°
      return `${year}. ${month}. ${day}.`;
    }

    const today = new Date();
    const formattedDate = formatDate(today);

	
    
    //  ë‚ ì§œ ì°¨ì´ ì¼ìˆ˜ ê³„ì‚°ê¸°
	function getDateDiff(dateString) {
      const today = new Date();
      const date = new Date(dateString);

      // ë‚ ì§œ ì°¨ì´ ê³„ì‚° (ë°€ë¦¬ì´ˆ ë‹¨ìœ„)
      const timeDiff = date - today;

      // ë‚ ì§œ ì°¨ì´ë¥¼ ì¼(day) ë‹¨ìœ„ë¡œ ë³€í™˜
      const diffInDays = Number(Math.floor(timeDiff / (1000 * 3600 * 24)));
      return diffInDays
      
    }

    // ë‚ ì§œë¥¼ í˜ì´ì§€ì— í‘œì‹œ
    document.getElementById("today-date").innerHTML = `ì˜¤ëŠ˜ ë‚ ì§œ: ${formattedDate}`;



    // âœ… ì—¬ëŸ¬ íŒŒì¼ ì—…ë¡œë“œ ëŒ€ì‘
    document.getElementById("fileInput").addEventListener("change", async function (e) {
    
      // âœ… íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì•ˆë‚´ ë¬¸êµ¬ ì œê±°
      document.getElementById("notice")?.remove();

    const files = Array.from(e.target.files);
    if (!files.length) return;
    
    // ìƒë‹¨ ì—…ë¡œë“œ ëª©ë¡ í‘œì‹œ
    const fileListHTML = files.map((f, i) => `<li>${i + 1}. ${f.name}</li>`).join("");
    document.getElementById("report").innerHTML = `
      <div class="section">
        <div class="section-header">ğŸ“‚ ì •ë¦¬ëœ sysinfo íŒŒì¼ ëª©ë¡ (${files.length}ê°œ)</div>
        <ul style="margin:17px 10px;">${fileListHTML}<br></ul>
      </div>`;

    // Promise.all ë¡œ ëª¨ë“  íŒŒì¼ ì²˜ë¦¬
    const results = await Promise.all(
      files.map((file) => {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = function (ev) {
            const text = ev.target.result;
            const match = (r) => text.match(r)?.[1]?.trim() || "-";
            const oknok = (v) => (v.match(/NOK/i) ? 'class="nok"' : "");

    // =======================================================================================
    // 1. General Info
    // =======================================================================================
    const host = match(/appliance-name\s+"([\w\-\_\.\,\~\@\#\(\)\=\+\<\>\[\]]+)"/i);
    const model = match(/Model\s*:\s*([A-Za-z0-9\-]+)/i);
    const serial = match(/Serial\s*Number\s*:\s*([0-9A-Z]+)/i);

    // SGOS Version (ì—‘ì…€ SUBSTITUTE + VLOOKUP ë¡œì§ ê¸°ë°˜)
    let sgos = "-";
    const versionLine = text.match(/Version:\s*([^\n]+)/i);
    if (versionLine) sgos = versionLine[1].replace(/"/g, "").trim();

    // HW/SW Uptime (ì—‘ì…€ MID + SUBSTITUTE + IF)
    let uptimeHW = "-";
    let uptimeSW = "-";
    let uptime = "-";

    // Match "hardware rebooted 891 days 15 hours ago"
    const hwMatch = text.match(/hardware rebooted\s+([\d\s\,\w]+hours)\,\s/i);
    if (hwMatch) uptimeHW = hwMatch[1].trim();

    // Match "software rebooted 891 days 15 hours ago"
    const swMatch = text.match(/softdware rebooted\s+([\d\s\,\w]+hours)\,\s/i);
    if (swMatch) uptimeSW = swMatch[1].trim();

    // Combine SW / HW values
    if (uptimeHW !== "-" && uptimeSW !== "-") {
      uptime = uptimeHW === uptimeSW ? uptimeHW : `${uptimeSW} / ${uptimeHW}`;
    } else {
      uptime = uptimeHW !== "-" ? uptimeHW : uptimeSW;
    }

    const cpuTemp = match(/CPU\s*\d*\s*temperature\s*([0-9]+(?:\.[0-9]+)?)\s*degrees\s/i);
    const sysTemp = match(/System center temperature\s*([0-9]+(?:\.[0-9]+)?)\s*degrees\s/i);
    
    
    
    
    // ---------------------------------------------------------------------------------------
    // Deployment Mode
    // ---------------------------------------------------------------------------------------
    // Explicitê³¼ External íŠ¸ë˜í”½ ë¹„êµ
    function sumBytesByKeys(keys) {
      let sum = 0;
      for (const key of keys) {
        const match = text.match(new RegExp(`${key}[^\n]*:\\s*([0-9\\s]+)`, "i"));
        if (match) {
          const nums = match[1].trim().split(/\s+/).map(Number).filter(n => !isNaN(n));
          if (nums.length > 0) sum += nums.reduce((a, b) => a + b, 0);
        }
      }
      return sum;
    }

    // Explicitê³¼ Externalì˜ í‚¤ì›Œë“œ
    const explicitKeys = [
      "svc:service:HTTP:Explicit HTTP:intercepted_client_bytes~monthly"
    ];
    const externalKeys = [
      "svc:service:HTTP:External HTTP:intercepted_client_bytes~monthly"
    ];

    // í•©ê³„ ê³„ì‚°
    const explicitBytes = sumBytesByKeys(explicitKeys);
    const externalBytes = sumBytesByKeys(externalKeys);

    // ë” í° ê°’ì„ ê°€ì§„ í•­ëª©ì„ í‘œê¸°
    const deploymentMode = explicitBytes > externalBytes ? "Explicit" : "TP";


    // =======================================================================================
    // 2.  Hardware & Network
    // =======================================================================================
    // CPU Usage (Now)
    let cpuNow = "-";
    const cpuHourlyMatch = text.match(/system:cpu-usage~hourly[^\n]*:\s*([0-9\s]+)/i);
    if (cpuHourlyMatch) {
      const nums_cpu = cpuHourlyMatch[1].trim().split(/\s+/).map(Number);
      cpuNow = nums_cpu.at(-1) + "%"; // ë§ˆì§€ë§‰ ê°’
    }

    // CPU Peak
    let cpuPeak = "-";
    const cpuDailyMatch = text.match(/system:cpu-usage~daily[^\n]*:\s*([0-9\s]+)/i);
    if (cpuHourlyMatch || cpuDailyMatch) {
      const hourlyMax_cpu = cpuHourlyMatch ? Math.max(...cpuHourlyMatch[1].trim().split(/\s+/).map(Number)) : 0;
      const dailyMax_cpu = cpuDailyMatch ? Math.max(...cpuDailyMatch[1].trim().split(/\s+/).map(Number)) : 0;
      const peak_cpu = Math.max(hourlyMax_cpu, dailyMax_cpu);
      cpuPeak = peak_cpu + "%";
    }
    
    // MEM Usage (Now)
    let memNow = "-";
    const memHourlyMatch = text.match(/system:memory-usage~hourly[^\n]*:\s*([0-9\s]+)/i);
    if (memHourlyMatch) {
      const nums_mem = memHourlyMatch[1].trim().split(/\s+/).map(Number);
      memNow = nums_mem.at(-1) + "%"; // ë§ˆì§€ë§‰ ê°’
    }

    // MEM Peak
    let memPeak = "-";
    const memDailyMatch = text.match(/system:memory-usage~daily[^\n]*:\s*([0-9\s]+)/i);
    if (memHourlyMatch || memDailyMatch) {
      const hourlyMax_mem = memHourlyMatch ? Math.max(...memHourlyMatch[1].trim().split(/\s+/).map(Number)) : 0;
      const dailyMax_mem = memDailyMatch ? Math.max(...memDailyMatch[1].trim().split(/\s+/).map(Number)) : 0;
      const peak_mem = Math.max(hourlyMax_mem, dailyMax_mem);
      memPeak = peak_mem + "%";
    }
    
    // Disk Status ì¢…í•© íŒë‹¨
    let disk = "-";
    const diskBlocks = text.match(/Stat:\s*Disk\s+\d+\s+Status[\s\S]*?(?=Stat:|$)/gi);
    if (diskBlocks && diskBlocks.length > 0) {
      const allOK = diskBlocks.every(block => /Current\s+State\s*:\s*OK/i.test(block));
      disk = allOK ? "OK" : "NOK";
    }

    // Tx / Rx Rate ê³„ì‚°
    let txRate = "-";
    let rxRate = "-";

    const interfaces = [];
    for (let i = 0; i <= 4; i++) {
      for (let j = 0; j <= 3; j++) {
        interfaces.push(`${i}:${j}`);
      }
    }

    // ê³µí†µ ì²˜ë¦¬ í•¨ìˆ˜
    function calcRate(direction) {
      let maxAvg = 0;
      for (const iface of interfaces) {
        const key = `tcpip:interface:${iface}:bytes-${direction}~daily15minute`;
        const match = text.match(new RegExp(`${key}[^\n]*:\\s*([\\d\\s]+)`, "i"));
        if (match) {
          const nums = match[1].trim().split(/\s+/).map(Number).filter(n => !isNaN(n));
          if (nums.length > 0) {
            // ìƒìœ„ 32ê°œ í‰ê· 
            const top32 = nums.sort((a, b) => b - a).slice(0, 32);
            const avg = top32.reduce((a, b) => a + b, 0) / top32.length;

            // byte â†’ bit ë³€í™˜, 900ì´ˆ(15ë¶„) ê¸°ì¤€ í™˜ì‚°
            const bps = (avg * 8) / 900;
            const mbps = bps / 1_000_000;
            if (mbps > maxAvg) maxAvg = mbps;
          }
        }
      }

      // ë‹¨ìœ„ ê²°ì •
      if (maxAvg > 0) {
        return maxAvg >= 1 ? `${maxAvg.toFixed(1)} Mbps` : `${(maxAvg * 1000).toFixed(1)} Kbps`;
      }
      return "-";
    }

    // Tx / Rx ëª¨ë‘ ê³„ì‚°
    txRate = calcRate("sent");
    rxRate = calcRate("received");

    
    // Users (ì—‘ì…€ì˜ @getmax ë¡œì§ ê¸°ë°˜)
    let users = "-";

    const usersMatch = text.match(/users:current~monthly[^\n]*:\s*([0-9\s]+)/i);
    if (usersMatch) {
      const nums = usersMatch[1].trim().split(/\s+/).map(Number).filter(n => !isNaN(n));
      if (nums.length > 0) {
        const maxUsers = Math.max(...nums);
        users = maxUsers.toString();
      }
    }

    // HTTPS Sessions (ì—‘ì…€ì˜ @getmax ë¡œì§ ê¸°ë°˜)
    let httpsSessions = "-";

    const sessionMatch = text.match(/http:client-volume~monthly[^\n]*:\s*([0-9\s]+)/i);
    if (sessionMatch) {
      const nums = sessionMatch[1].trim().split(/\s+/).map(Number).filter(n => !isNaN(n));
      if (nums.length > 0) {
        const maxSess = Math.max(...nums);
        httpsSessions = maxSess.toString();
      }
    }

    

    //-------------------------------------------------------------
    // Total Traffic (svc:ds:proxy:intercepted_client_bytes~monthly)
    //-------------------------------------------------------------
    let totalTraffic = "-";

    const totalMatch = text.match(/svc:ds:proxy:intercepted_client_bytes~monthly[^\n]*:\s*([0-9\s]+)/i);
    if (totalMatch) {
      const nums = totalMatch[1].trim().split(/\s+/).map(Number).filter(n => !isNaN(n));
      if (nums.length > 0) {
        const sumBytes = nums.reduce((a, b) => a + b, 0);

        // Byte â†’ MB/GB/TB ë‹¨ìœ„ ë³€í™˜ (10ì§„ ë‹¨ìœ„)
        let value = sumBytes;
        let unit = "Bytes";
        if (value >= 1e12) {
          value = value / 1e12;
          unit = "TB";
        } else if (value >= 1e9) {
          value = value / 1e9;
          unit = "GB";
        } else if (value >= 1e6) {
          value = value / 1e6;
          unit = "MB";
        } else if (value >= 1e3) {
          value = value / 1e3;
          unit = "KB";
        }
        totalTraffic = `${value.toFixed(2)} ${unit}`;
      }
    }

    //-------------------------------------------------------------
    // Peak Traffic (monthly/daily/hourly ë‹¨ìœ„ë³„ ë³€í™˜ í¬í•¨)
    //-------------------------------------------------------------
    let peakTraffic = "-";
    let peakMbps = 0;

    // ëŒ€ìƒ í‚¤ì›Œë“œì™€ ë‹¨ìœ„ ë³€í™˜ ë¹„ìœ¨ (ì´ˆ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ëŠ” ê°’)
    const peakKeys = [
      { key: "svc:ds:proxy:intercepted_client_bytes~monthly", divisor: 24 * 60 * 60 },
      { key: "svc:ds:proxy:intercepted_client_bytes~daily", divisor: 60 * 60 },
      { key: "svc:ds:proxy:intercepted_client_bytes~hourly", divisor: 60 }
    ];

    // ê° êµ¬ê°„ë³„ë¡œ ìµœëŒ€ê°’ ë¹„êµ
    for (const item of peakKeys) {
      const match = text.match(new RegExp(`${item.key}[^\n]*:\\s*([0-9\\s]+)`, "i"));
      if (match) {
        const nums = match[1].trim().split(/\s+/).map(Number).filter(n => !isNaN(n));
        if (nums.length > 0) {
          const maxBytes = Math.max(...nums);

          // Byte â†’ bit ë³€í™˜ í›„, í•´ë‹¹ êµ¬ê°„ ì‹œê°„ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ê³  Mbpsë¡œ ë³€í™˜
          const bps = (maxBytes * 8) / item.divisor;
          const mbps = bps / 1_000_000;

          if (mbps > peakMbps) peakMbps = mbps;
        }
      }
    }

    if (peakMbps > 0) {
      peakTraffic = `${peakMbps.toFixed(1)} Mbps`;
    }


    //-------------------------------------------------------------
    // HTTP% + HTTPS% ê³„ì‚° (ì—‘ì…€ Sysinfo_1 ë™ì¼)
    //-------------------------------------------------------------

    // ì•ˆì „í•œ í‚¤ì›Œë“œ ë§¤ì¹­ í•¨ìˆ˜ (ê³µë°±/íŠ¹ìˆ˜ë¬¸ì ëŒ€ì‘)
    function safeMatchKey(key) {
      const safeKey = key.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      return text.match(new RegExp(`${safeKey}[^\n]*:\\s*([0-9\\s]+)`, "i"));
    }

    // íŠ¹ì • í‚¤ì›Œë“œ ì„¸íŠ¸ì˜ ìˆ«ì í•©ê³„ ê³„ì‚° í•¨ìˆ˜
    function sumBytesByKeys(keys) {
      let sum = 0;
      for (const key of keys) {
        const match = safeMatchKey(key);
        if (match) {
          const nums = match[1].trim().split(/\s+/).map(Number).filter(n => !isNaN(n));
          if (nums.length > 0) sum += nums.reduce((a, b) => a + b, 0);
        }
      }
      return sum;
    }

    //------------------------
    // HTTP% ê³„ì‚°
    //------------------------
    let httpPercent = "-";

    const httpKeys = [
      "svc:proxy:HTTP:intercepted_client_bytes~monthly",
      "svc:proxy:HTTP:bypassed_bytes~monthly"
    ];
    const totalKeys_HTTP = [
      "svc:ds:proxy:bypassed_bytes~monthly",
      "svc:ds:proxy:intercepted_client_bytes~monthly"
    ];

    const httpBytes = sumBytesByKeys(httpKeys);
    const totalBytes_HTTP = sumBytesByKeys(totalKeys_HTTP);

    if (httpBytes > 0 && totalBytes_HTTP > 0) {
      const ratio = (httpBytes / totalBytes_HTTP) * 100;
      httpPercent = `${ratio.toFixed(1)}%`;
    }

    //------------------------
    // HTTPS% ê³„ì‚°
    //------------------------
    let httpsPercent = "-";

    const httpsKeys = [
      "svc:proxy:HTTPS Forward Proxy:intercepted_client_bytes~monthly"
    ];
    const sslKeys = [
      "svc:proxy:SSL:intercepted_client_bytes~monthly",
      "svc:proxy:SSL:bypassed_bytes~monthly"
    ];
    const totalKeys_HTTPS = [
      "svc:ds:proxy:bypassed_bytes~monthly",
      "svc:ds:proxy:intercepted_client_bytes~monthly"
    ];

    const httpsBytes = sumBytesByKeys(httpsKeys);
    const sslBytes = sumBytesByKeys(sslKeys);
    const totalBytes_HTTPS = sumBytesByKeys(totalKeys_HTTPS);

    if (totalBytes_HTTPS > 0 && (httpsBytes > 0 || sslBytes > 0)) {
      const httpsRatio = httpsBytes / totalBytes_HTTPS;
      const sslRatio = sslBytes / totalBytes_HTTPS;
      const totalRatio = (httpsRatio + sslRatio) * 100;
      httpsPercent = `${totalRatio.toFixed(1)}%`;
    }

    //-------------------------------------------------------------
    // Savings% ê³„ì‚° (ì—‘ì…€ Sysinfo_1 ë™ì¼)
    //-------------------------------------------------------------
    let savingsPercent = "-";

    // í‚¤ì›Œë“œ ì •ì˜
    const serverKeys = ["svc:ds:proxy:intercepted_server_bytes~monthly"];
    const clientKeys = ["svc:ds:proxy:intercepted_client_bytes~monthly"];

    // ì„œë²„ / í´ë¼ì´ì–¸íŠ¸ ë°”ì´íŠ¸ í•©ê³„ ê³„ì‚°
    const serverBytes = sumBytesByKeys(serverKeys);
    const clientBytes = sumBytesByKeys(clientKeys);

    // ì ˆê°ìœ¨ ê³„ì‚°
    if (serverBytes > 0 && clientBytes > 0) {
      const ratio = (1-(serverBytes / clientBytes)) * 100;
      savingsPercent = `${ratio.toFixed(1)}%`;
    }

	// =======================================================================================
    // 3. Proxy Features
    // =======================================================================================
    // ë‚ ì§œ í¬ë§·ì„ 'yyyy. mm. dd.' í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function formatDate(dateString) {
      const date = new Date(dateString);
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0'); // ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1
      const day = date.getDate().toString().padStart(2, '0'); // ë‚ ì§œ ë‘ ìë¦¿ìˆ˜ë¡œ ë§ì¶”ê¸°

      return `${year}. ${month}. ${day}.`;
    }

    // 'Licensed Until:' í‚¤ì›Œë“œì—ì„œ ë‚ ì§œ ì¶”ì¶œ
    const licenseMatch = text.match(/Licensed Until:[\s\,\w]*\s(\d{1,2}\s\w{3}\s\d{4})\s/i);
    let licenseDate = "ì •ë³´ ì—†ìŒ";

    if (licenseMatch) {
      // ë‚ ì§œ í¬ë§· ë³€í™˜
      licenseDate = formatDate(licenseMatch[1]);
    }
    
    // Web Filtering Database í™•ì¸
    function getClosestDate(text) {
      let dataValid = "-";
      let urlFilter = "-";

      // âœ… 1ï¸âƒ£ Data Source êµ¬ë¶„
      const dataSourceMatch = text.match(/Data Source:\s*(Intelligence Services|WebFilter)/i);
      if (dataSourceMatch) {
        if (/Intelligence Services/i.test(dataSourceMatch[1])) urlFilter = "BCIS";
        else if (/WebFilter/i.test(dataSourceMatch[1])) urlFilter = "BCWF";
      }

      // âœ… 2ï¸âƒ£ ë‚ ì§œ ì¶”ì¶œ
      if (urlFilter === "BCIS") {
        // BCIS â†’ ê¸°ì¡´ ë¡œì§ ì‚¬ìš©
        const dates = [];
        const dataValidMatch = text.match(/Data Valid Until:[^\n]*?(\d{1,2}\s\w{3}\s\d{4})/);
        const blueCoatDownloadMatch = text.match(/Blue Coat download at:[^\n]*?(\d{1,2}\s\w{3}\s\d{4})/);
        const differentialUpdateMatch = text.match(/Differential update[^\n]*?(\d{1,2}\s\w{3}\s\d{4})/);
        const timeMatch = text.match(/Time:\s*(\d{1,2}\s\w{3}\s\d{4})/);

        if (dataValidMatch) dates.push(new Date(dataValidMatch[1]));
        if (blueCoatDownloadMatch) dates.push(new Date(blueCoatDownloadMatch[1]));
        if (differentialUpdateMatch) dates.push(new Date(differentialUpdateMatch[1]));
        if (timeMatch) dates.push(new Date(timeMatch[1]));

        if (dates.length > 0) {
          const maxDate = new Date(Math.max(...dates));
          dataValid = maxDate.toLocaleDateString();
        }
      }

      else if (urlFilter === "BCWF") {
        // BCWF â†’ "Database expires:" ì¤„ë§Œ ì‚¬ìš©
        const dbExpireMatch = text.match(/Database expires:\s*([A-Za-z]{3},\s*\d{1,2}\s*[A-Za-z]{3}\s*\d{4})/i);
        if (dbExpireMatch) {
          const dateStr = dbExpireMatch[1].replace(/,/g, "").trim(); // Tue, 19 Jan 2038 â†’ Tue 19 Jan 2038
          const parsed = new Date(dateStr);
          if (!isNaN(parsed)) {
            dataValid = parsed.toLocaleDateString();
          }
        }
      }

      return { dataValid, urlFilter };
    }


    // í•¨ìˆ˜ ì‚¬ìš©
    const { dataValid, urlFilter } = getClosestDate(text);


    // ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ í•¨ìˆ˜
    const localDBMatch = text.match(/Local database download at:\s*(\d{4}\/\d{2}\/\d{2})\s/i);

    let localDBDate = "-";  // ê¸°ë³¸ê°’
	
    if (localDBMatch) {
      // ë‚ ì§œ ë¬¸ìì—´ì„ yyyy. mm. dd. í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      const rawDate = localDBMatch[1];  // 2025/07/28
      const dateParts = rawDate.split("/");  // ["2025", "07", "28"]
      localDBDate = `${dateParts[0]}. ${dateParts[1]}. ${dateParts[2]}.`;  // "2025. 07. 28."
    }
    
    const webpulse = match(/WebPulse:\s*(Enabled|Disabled)/i);
    const appProtect = match(/Application Protection:\s*(Enabled|Disabled)/i);
    
    
    // application-classification ;mode í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì°¾ê¸°
    const appClassKeywordMatch = text.match(/application-classification\s*;\s*mode/i);

    let appClass = "-";

    if (appClassKeywordMatch) {
      // í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì¸ë±ìŠ¤ ì°¾ê¸°
      const lines = text.split("\n");  // í…ìŠ¤íŠ¸ë¥¼ ì¤„ë³„ë¡œ ë¶„ë¦¬
      const appClassIndex = lines.findIndex(line => line.includes("application-classification ;mode"));

      // ë°”ë¡œ ë‹¤ìŒ ì¤„ í™•ì¸
      if (appClassIndex !== -1 && lines[appClassIndex + 1]?.trim() === "enable") {
        appClass = "Enabled";  // ê·¸ ë‹¤ìŒ ì¤„ ê°’ì´ 'enable'ì´ë©´ Enabledë¡œ ì„¤ì •
      }
    }


	// security windows-domains ;mode í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì°¾ê¸°
    const authKeywordMatch = text.match(/security\swindows\-domains\s*;mode/i);

    let auth = "-";

    if (authKeywordMatch) {
      // í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì¸ë±ìŠ¤ ì°¾ê¸°
      const auth_lines = text.split("\n");  // í…ìŠ¤íŠ¸ë¥¼ ì¤„ë³„ë¡œ ë¶„ë¦¬
      const authIndex = auth_lines.findIndex(line => line.includes("security windows-domains ;mode"));

      // ë°”ë¡œ ë‹¤ìŒ ì¤„ í™•ì¸
      if (authIndex !== -1 && auth_lines[authIndex + 1]?.trim().includes("hostname")) {
        auth = "Enabled";
      }
    }

    const etap = match(/client\.connection[\.\w\_]+tap\s*\(([\d\:]+)\)/i);

	// =======================================================================================
    // 4. Logging & Services
    // =======================================================================================
    const icapReq = "ê·€ì°®ì•„ì„œ";
	const icapResp = "ì•„ì§ ì•ˆë§Œë“¦";
    
    
    // Title: Access Log (main) Statistics í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì°¾ê¸°
    const mainKeywordMatch = text.match(/Title\:\sAccess\sLog\s\(main\)\sStatistics/i);
    let httpLog = "-";
    if (mainKeywordMatch) {
      // í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì¸ë±ìŠ¤ ì°¾ê¸°
      const main_lines = text.split("\n");  // í…ìŠ¤íŠ¸ë¥¼ ì¤„ë³„ë¡œ ë¶„ë¦¬
      const mainIndex = main_lines.findIndex(line => line.includes("Title: Access Log (main) Statistics"));

      // AL_STATS_0037 ê°’ì„ í¬í•¨í•œ 37ë²ˆì§¸ ì¤„ í™•ì¸
      const http_targetLine = main_lines[mainIndex + 37]?.trim();

      // AL_STATS_0037 ë‹¤ìŒ ê°’ì„ ì¶”ì¶œ
      const http_match = http_targetLine.match(/AL_STATS_0037\s*(\d+)/);
      if (http_match) {
        httpLog = (http_match[1]/1000/1000).toFixed(1); // AL_STATS_0037 ì´í›„ ìˆ«ìë¥¼ httpLogì— ì €ì¥
      }
    }


	// Title: Access Log (ssl) Statistics í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì°¾ê¸°
    const sslKeywordMatch = text.match(/Title\:\sAccess\sLog\s\(ssl\)\sStatistics/i);
    let httpsLog = "-";
    if (sslKeywordMatch) {
      // í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì¸ë±ìŠ¤ ì°¾ê¸°
      const ssl_lines = text.split("\n");  // í…ìŠ¤íŠ¸ë¥¼ ì¤„ë³„ë¡œ ë¶„ë¦¬
      const sslIndex = ssl_lines.findIndex(line => line.includes("Title: Access Log (ssl) Statistics"));

      // AL_STATS_0037 ê°’ì„ í¬í•¨í•œ 37ë²ˆì§¸ ì¤„ í™•ì¸
      const ssl_targetLine = ssl_lines[sslIndex + 37]?.trim();

      // AL_STATS_0037 ë‹¤ìŒ ê°’ì„ ì¶”ì¶œ
      const ssl_match = ssl_targetLine.match(/AL_STATS_0037\s*(\d+)/);
      if (ssl_match) {
        httpsLog = (ssl_match[1]/1000/1000).toFixed(1); // AL_STATS_0037 ì´í›„ ìˆ«ìë¥¼ httpsLogì— ì €ì¥
      }
    }
    
    
    // format-name ssl í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì°¾ê¸°
    const LogbackupKeywordMatch = text.match(/format\-name\sssl/i);

    let Logbackup = "-";

    if (LogbackupKeywordMatch) {
      // í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì¸ë±ìŠ¤ ì°¾ê¸°
      const Logbackup_lines = text.split("\n");  // í…ìŠ¤íŠ¸ë¥¼ ì¤„ë³„ë¡œ ë¶„ë¦¬
      const LogbackupIndex = Logbackup_lines.findIndex(line => line.includes("format-name ssl"));

      // ë°”ë¡œ ë‹¤ìŒ ì¤„ í™•ì¸
      if (LogbackupIndex !== -1 && Logbackup_lines[LogbackupIndex + 1]?.trim().includes("ftp-client primary")) {
        Logbackup = "FTP";
      }
    }


    // syslog enable í‚¤ì›Œë“œ í™•ì¸
    let syslogStatus = "-";
    const syslogMatch = text.match(/syslog\s+enable/i);

    if (syslogMatch) {
      syslogStatus = "Syslog";
    }
    
    
    const coreImage = match(/restart\score\-image\s([\w]+)/i);
    
    
    const getClassForDate = (dateString) => {
    const today = new Date();
    const targetDate = new Date(dateString);

    // ë‚ ì§œ ì°¨ì´ ê³„ì‚°
    const diffInTime = today - targetDate;
    const diffInDays = Math.floor(diffInTime / (1000 * 3600 * 24)); // ì¼ ë‹¨ìœ„ë¡œ ë³€í™˜

    // ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
    return (diffInDays <= 30) ? "yellow" : (diffInDays > 30 && diffInDays <= 60 ? "yellow" : "red");
  };

    
    // =======================================================================================
    // ê²°ê³¼ë¥¼ resolveë¡œ ë°˜í™˜
    // =======================================================================================
            resolve({
              name: file.name,
              section1: `<tr>
                  <td>${host}</td><td>${model}</td>
                  <td>${serial}</td>
                  <td>${sgos}</td>
                  <td>${uptime}</td>
                  <td>${cpuTemp ? cpuTemp+"Â°C" : "-"}</td>
                  <td>${sysTemp ? sysTemp+"Â°C" : "-"}</td>
                  <td>${deploymentMode}</td>
                </tr>`,
              section2: `<tr>
                  <td>${cpuNow} / ${cpuPeak}</td>
                  <td>${memNow} / ${memPeak}</td>
                  <td ${oknok(disk)}>${disk}</td>
                  <td>${txRate}</td>
                  <td>${rxRate}</td>
                  <td>${users}</td>
                  <td>${httpsSessions}</td>
                  <td>${totalTraffic}</td>
                  <td>${peakTraffic}</td>
                  <td>${httpPercent}</td>
                  <td>${httpsPercent}</td>
                  <td>${savingsPercent}</td>
                </tr>`,
              section3: `<tr>
                  <td>${licenseDate} (${getDateDiff(licenseDate)}ì¼)</td>
                  <td>${urlFilter} / ${dataValid} (${getDateDiff(dataValid)}ì¼)</td>
                  <td>${localDBDate} (${getDateDiff(localDBDate)}ì¼)</td>
                  <td>${webpulse}</td>
                  <td>${appProtect}</td>
                  <td>${appClass}</td>
                  <td>${auth}</td>
                  <td>${etap}</td>
                </tr>`,
              section4: `<tr>
                  <td>${icapReq}</td>
                  <td>${icapResp}</td>
                  <td>${httpLog}MB</td>
                  <td>${httpsLog}MB</td>
                  <td>${Logbackup}</td>
                  <td>${syslogStatus}</td>
                  <td>${coreImage}</td>
                </tr>`
            });
          };
          reader.readAsText(file);
        });
      })
    );

    // âœ… ëª¨ë“  íŒŒì¼ ì½ì€ ë’¤ HTML ìƒì„±
    const s1 = results.map((r) => r.section1).join("");
    const s2 = results.map((r) => r.section2).join("");
    const s3 = results.map((r) => r.section3).join("");
    const s4 = results.map((r) => r.section4).join("");
    
    const sanitize = (s) => s.replace(/\bNaN\b/g, "-").replace(/undefined|null/gi, "-");


    document.getElementById("report").innerHTML += sanitize(`
      <div class="section">
        <div class="section-header">â‘  General Information & Configuration Backup</div>
        <table>
          <tr>
          	<th colspan="5">Appliance</th>
            <th colspan="2">Temperature</th>
            <th rowspan="2">Deployment Mode</th>
          </tr>
          <tr>
          	<th>Host Name</th>
            <th>Model</th>
            <th>Serial Number</th>
            <th>SGOS Version</th>
            <th>Uptime (SW/HW)</th>
            <th>CPU Temp</th>
            <th>System Temp</th>
          </tr>
          ${s1}
        </table>
      </div>

      <div class="section">
        <div class="section-header">â‘¡ Hardware & Network</div>
        <table>
          <tr>
          	<th rowspan="2">CPU Usage<br>(Now/Peak)</th>
            <th rowspan="2">MEM Usage<br>(Now/Peak)</th>
            <th rowspan="2">Disk Status</th>
            <th colspan="2">Interface</th>
            <th colspan="2">Network (Peak)</th>
            <th colspan="5">Intercepted Traffic Usage</th>
          </tr>
          <tr>
          	<th>Tx Rate</th>
            <th>Rx Rate</th>
            <th>Users</th>
            <th>HTTPS Sessions</th>
            <th>Total Traffic</th>
            <th>Peak Traffic</th>
            <th>HTTP%</th>
            <th>HTTPS%</th>
            <th>Savings</th>
  		   </tr>
          ${s2}
        </table>
      </div>

      <div class="section">
        <div class="section-header">â‘¢ Proxy Features</div>
        <table>
          <tr>
          	<th rowspan="2">License Expiry</th>
            <th rowspan="2">Web Filtering Database</th>
            <th rowspan="2">Local DB</th>
            <th colspan="2">Threat Protection</th>
            <th colspan="3">Configuration</th>
  		  </tr>
          <tr>
          	<th>WebPulse</th>
            <th>App Protect</th>
            <th>App Class</th>
            <th>Auth (AD)</th>
            <th>eTap</th>
  		  </tr>
          ${s3}
        </table>
      </div>

      <div class="section">
        <div class="section-header">â‘£ Logging & Services</div>
        <table>
          <tr>
          	<th colspan="2">Content Analysis (ICAP)</th>
            <th colspan="2">Access Logs Size</th>
            <th colspan="3">Log Backup Settings</th>
          </tr>
          <tr>
          	<th>REQ</th>
            <th>RESP</th>
            <th>HTTP Log</th>
            <th>HTTPS Log</th>
            <th>Access Log Backup</th>
            <th>Event Log Backup</th>
            <th>Core Image</th>
          </tr>
          ${s4}
        </table>
      </div>`);
  });
  
  
  // =======================================================================================
  // HTML ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ê¸°ëŠ¥
  // =======================================================================================
  document.getElementById("downloadBtn").addEventListener("click", function () {
    // í˜„ì¬ í˜ì´ì§€ HTML ì „ì²´ë¥¼ Blobìœ¼ë¡œ ì €ì¥
    const fullHTML = document.documentElement.outerHTML;
    const blob = new Blob([fullHTML], { type: "text/html" });

    // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë°˜ íŒŒì¼ëª…
    const date = new Date();
    const yyyy = date.getFullYear();
    const mm = String(date.getMonth() + 1).padStart(2, "0");
    const dd = String(date.getDate()).padStart(2, "0");
    const fileName = `ProxySG_Report_${yyyy}${mm}${dd}.html`;

    // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± ë° ì‹¤í–‰
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = fileName;
    a.click();

    // ë©”ëª¨ë¦¬ í•´ì œ
    URL.revokeObjectURL(a.href);
  });
  
  
  

</script>

<script>
  // === ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ ì¶”ê°€ ===
  const dropZone = document.getElementById("dropZone");

  // ê¸°ë³¸ ì´ë²¤íŠ¸ ë§‰ê¸° + ë“œë˜ê·¸ ì‹œ ìŠ¤íƒ€ì¼ ë³€ê²½
  ["dragenter", "dragover"].forEach(eventName => {
    dropZone.addEventListener(eventName, (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.add("dragover");
    });
  });

  // ë“œë˜ê·¸ ì¢…ë£Œ ì‹œ ìŠ¤íƒ€ì¼ ë³µêµ¬
  ["dragleave", "drop"].forEach(eventName => {
    dropZone.addEventListener(eventName, (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.remove("dragover");
    });
  });

  // ë“œë¡­ ì‹œ íŒŒì¼ ì²˜ë¦¬
  dropZone.addEventListener("drop", (e) => {
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      // inputì˜ change ì´ë²¤íŠ¸ì™€ ë™ì¼í•˜ê²Œ ì‹¤í–‰
      document.getElementById("fileInput").files = files;
      const event = new Event("change");
      document.getElementById("fileInput").dispatchEvent(event);
    }
  });
</script>


<!-- === ëª¨ë‹¬ íŠ¸ë¦¬ê±° ë²„íŠ¼ === -->
<button id="openModal">ğŸ§© curl ëª…ë ¹ì–´ ë§Œë“¤ê¸°</button>

<!-- === ëª¨ë‹¬ êµ¬ì¡° === -->
<div id="modalOverlay" class="modal-overlay">
  <div class="modal">
    <button class="close-btn">Ã—</button>

    <!-- === ì‹¤ì œ Sysinfo curl ìƒì„±ê¸° HTML ì‚½ì… === -->
    <div class="container">
      <h2>Sysinfo curl ëª…ë ¹ì–´ ìƒì„±ê¸° <span class="badge">ë§ˆì§€ë§‰ë§Œ explorer ì‹¤í–‰</span></h2>

      <div class="input-row">
        <div>
          <label>Username</label>
          <input id="username" type="text" class="w-sm" placeholder="admin">
        </div>
        <div>
          <label>Password</label>
          <input id="password" type="password" class="w-sm" placeholder="password">
        </div>
        <div>
          <label>Path</label>
          <input id="endpoint" type="text" class="w-md" value="/sysinfo">
        </div>
      </div>

      <div class="input-row">
        <div style="width:90%;">
          <label>Proxy IP / Host (ì—¬ëŸ¬ ê°œ ì…ë ¥ ê°€ëŠ¥)</label>
          <textarea id="proxyList" placeholder="ì˜ˆ: 192.168.1.10, 192.168.1.11"></textarea>
        </div>
      </div>

      <label>ìƒì„±ëœ curl ëª…ë ¹</label>
      <pre id="cmds"></pre>

      <div class="actions">
        <button id="copy">ì „ì²´ ë³µì‚¬</button>
        <span class="note">ğŸ“‚ ë§ˆì§€ë§‰ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ í›„ì—ë§Œ í´ë”ê°€ ì—´ë¦½ë‹ˆë‹¤.</span>
      </div>
    </div>
  </div>
</div>

<script>
  // === ëª¨ë‹¬ ì œì–´ ===
  const openModal = document.getElementById("openModal");
  const modalOverlay = document.getElementById("modalOverlay");
  const closeBtn = document.querySelector(".close-btn");

  openModal.addEventListener("click", () => modalOverlay.style.display = "flex");
  closeBtn.addEventListener("click", () => modalOverlay.style.display = "none");
  modalOverlay.addEventListener("click", e => { if (e.target === modalOverlay) modalOverlay.style.display = "none"; });
  document.addEventListener("keydown", e => { if (e.key === "Escape") modalOverlay.style.display = "none"; });

  // === curl ìƒì„±ê¸° ë¡œì§ ===
  (function(){
    const username=document.getElementById('username');
    const password=document.getElementById('password');
    const proxyList=document.getElementById('proxyList');
    const endpoint=document.getElementById('endpoint');
    const cmdsEl=document.getElementById('cmds');
    const copyBtn=document.getElementById('copy');

    function pad(n){return n<10?'0'+n:n;}
    function yyyymmdd(d){return d.getFullYear()+pad(d.getMonth()+1)+pad(d.getDate());}
    function tailForFilename(host){
      if(!host)return'ip';
      try{
        let h=host.trim().replace(/^https?:\/\//i,'').replace(/\/.*$/,'');
        if(h.includes(':'))h=h.split(':')[0];
        const parts=h.split('.');
        const last=parts[parts.length-1];
        if(/^\d+$/.test(last))return last;
        return h.replace(/[^0-9a-zA-Z]/g,'_').slice(0,15)||'host';
      }catch{return'ip';}
    }
    function parseHosts(raw){return raw.split(/[, \t\r\n]+/).map(x=>x.trim()).filter(Boolean);}
    function buildCommands(){
      const u=username.value.trim(), p=password.value;
      const ep=endpoint.value.trim()||'/sysinfo';
      const epFinal=ep.startsWith('/')?ep:'/'+ep;
      const hosts=parseHosts(proxyList.value);
      const date=yyyymmdd(new Date());
      const cmds=[];
      hosts.forEach((h, idx)=>{
        const tail=tailForFilename(h);
        const filename=`sysinfo_${tail}_${date}.txt`;
        const cred=(u||p)?`${u}:${p}`:'';
        const credPart=cred?`-u ${cred} `:'';
        const explorerPart=(idx===hosts.length-1)?" && explorer .":"";
        cmds.push(`curl -k ${credPart}https://${h}:8082${epFinal} -o ${filename}${explorerPart}`);
      });
      return cmds;
    }
    function refresh(){
      const cmds=buildCommands();
      cmdsEl.textContent=cmds.length?cmds.join('\n'):'# IP/Hostë¥¼ ì…ë ¥í•˜ì„¸ìš”';
    }
    [username,password,proxyList,endpoint].forEach(e=>e.addEventListener('input',refresh));
    refresh();
    copyBtn.onclick=async()=>{
      try{
        await navigator.clipboard.writeText(cmdsEl.textContent);
        copyBtn.textContent='ë³µì‚¬ë¨ âœ“';
        setTimeout(()=>copyBtn.textContent='ì „ì²´ ë³µì‚¬',1500);
      }catch{alert('ë³µì‚¬ ì‹¤íŒ¨');}
    };
  })();
</script>


</body>
</html>
